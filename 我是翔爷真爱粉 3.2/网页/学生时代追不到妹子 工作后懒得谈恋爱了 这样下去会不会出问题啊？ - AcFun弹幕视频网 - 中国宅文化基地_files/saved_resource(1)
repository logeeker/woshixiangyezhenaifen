(function(){var $$,bind,__slice=[].slice;(function(){var p,s;s=window.system={ver:"0.3.12",st:$.now(),date:window.date,path:{base:(p=window.path).base,cdn:p.cdn,ssl:p.ssl,api:p.api},location:"location-guru",url:location.href.toString(),timer:{},gate:{actionFollowAllowed:1},port:{},func:{},param:{},hash:{},handle:{},require:{},session:{},browser:{},debug:window.debug};s.path.short=s.debug?"/dotnet/date":s.path.cdn+"/dotnet/20130418";return window.path=window.date=null})();window.user={ver:"0.1.0",name:$.cookie("ac_username")||"用户",avatar:$.cookie("ac_userimg")||system.path.short+"/style/image/avatar.jpg",online:0,ban:false,uid:-1,group:-1};window.config={ver:"0.0.4",globe:{themeEffectAllowed:1,guideFloatAllowed:1},channel:{style:"th-large"},player:{playerFloatAllowed:1},comment:{videoViewAllowed:0,autoShowCommentAllowed:1},album:{hidePlaylistAllowed:0}};window.cache={ver:"0.2.10",history:{views:[],comms:[],ups:[]},save:{}};$.ajaxSetup({cache:true});$$=window.$$=function(selector){var h,s;h=system.handle;if(s=selector){return h[s]||(h[s]=$(s))}else{return h}};$.salt=function(day){var c,d,r,s,_base;if(day==null){day=1}if(r=(c=(_base=$.salt).cache!=null?_base.cache:_base.cache={})[d=day||1]){return r}else{return c[d]="?salt="+(!(s=system).debug?(s.st/(864e5*d)|0)+s.ver.replace(/\./g,""):s.st)}};bind=function(c,a){var d,v,_i,_len,_results;_results=[];for(_i=0,_len=a.length;_i<_len;_i++){d=a[_i];v=d.split(".");if(v.length===1){_results.push(function(){var f;f=v[0];return $[f]=function(){var p;p=1<=arguments.length?__slice.call(arguments,0):[];return $.require(c,function(){return $[f].apply($,p)})}}())}else{_results.push(function(){var f;f=v[1];return $.fn[f]=function(){var e,p;p=1<=arguments.length?__slice.call(arguments,0):[];e=this;$.require(c,function(){return e[f].apply(e,p)});return e}}())}}return _results};bind("info",["info","fn.info","fn.riseInfo"]);$.i=function(){var p;p=1<=arguments.length?__slice.call(arguments,0):[];if(system.debug){return $.require("info",function(){return $.i.apply($,p)})}};$.log=function(param){return typeof console!=="undefined"&&console!==null?typeof console.log==="function"?console.log(param):void 0:void 0};$.fn.hoverInfo=function(param,callback){return this.each(function(){var c,obj;obj=$(this);return obj.off(c=".hoverInfo").on("mouseenter"+c,function(){return obj.info(param,callback)}).on("mouseleave"+c,function(){return $("#win-hint").click()})})};if(window.Worker){bind("transit",["fn.transition"])}else{$.fn.transition=function(){var p,_ref;p=1<=arguments.length?__slice.call(arguments,0):[];return(_ref=$(this)).animate.apply(_ref,p)}}$.fn.scrollOnto=function(time,callback){if(time==null){time=500}return this.eq(0).each(function(){var top;top=$(this).offset().top-64;return $("body, html").stop().animate({scrollTop:top},time,function(){return typeof callback==="function"?callback():void 0})})};$.isViewing=function(elem){var e,f;f=function(e){var pa,pb,root,ya,yb;if(e!=null?e.length:void 0){root=$(window);ya=root.scrollTop();yb=ya+root.innerHeight();pa=e.offset().top;pb=pa+e.height();if(yb>pa&&pa>ya||yb>pb&&pb>ya||pa<ya&&pb>yb){return true}else{return false}}else{return false}};switch($.type(e=elem)){case"string":return f($(e));case"object":return f(e);default:return false}};$.save=function(param,callback){return $.delay("save",200,function(){var error,func;func={name:"$.save()"};error=function(e){return $.i(""+func.name+"#"+e)};if(param){switch(param){case"cache":store.set("cache",cache);break;case"config":store.set("config",config);break;case"user":store.set("user",user);break;default:error(6)}return typeof callback==="function"?callback():void 0}else{return error(5)}})};$.fn.setup=function(param,callback){var error,func,p;func={name:"$.fn.setup",token:"mimiko",callback:callback};error=function(e){return $.i("["+func.name+"]#"+e)};switch($.type(p=param)){case"function":func.callback=p;break;case"object":$.extend(func,p)}return this.each(function(){var elem;elem=func.singer=$(this);if(!elem.data().setuped){if(elem.hasClass("dropdown")){return $.require("etc",function(){return $.fn.setup.readyDropdown(func)})}else if(elem.hasClass("tabb")){return $.fn.setup.readyTabbable(func)}else if(elem.hasClass("form")){return $.require("form",function(){return($.fn.setup.readyForm||system.func.readyForm)(func)})}else if(elem.hasClass("switch")){return elem.click(function(){if(!elem.hasClass("disabled")){elem.toggleClass("active");return typeof func.callback==="function"?func.callback():void 0}})}else{return error(4)}}})};$.fn.setup.readyTabbable=function(func){var banner,obj,pages,tabs;if(typeof func.start==="function"){func.start()}obj=func.singer;banner=obj.children(".banner:not(.fake):first");tabs=banner.children(".tab");pages=obj.children(".page");banner.children(".tab").not(".fixed, .more, .tool").click(function(){var page,tab;tab=$(this);page=obj.children(".page:eq("+tab.index()+")");tabs.filter(".active").removeClass("active");pages.filter(".active").removeClass("active");tab.addClass("active");page.addClass("active");return typeof func.callback==="function"?func.callback():void 0});obj.data().setuped=1;return typeof func.finish==="function"?func.finish():void 0};$.check=function(param,callback){var error,func;func={name:"$.check()"};error=function(e){return $.i("["+func.name+"]#"+e)};if(param&&$.type(param)==="string"){func.type=$.trim(param);switch(func.type){case"login":case"online":user.uid=$.cookie("auth_key")|0;if(user.uid){user.online=1;user.name=$.cookie("ac_username");user.key=$.cookie("auth_key_ac_sha1");if($.cookie("ac_time")!=null){user.group=0}else{user.group=2}if(typeof callback==="function"){callback()}return true}else{user.online=0;user.group=1;user.name="游客";if(typeof callback==="function"){callback()}return false}break;case"unread":$.get("/member/unRead.aspx",{uid:user.uid}).done(function(data){user.unread={push:data.newPush,at:data.mention,mail:data.unReadMail,fan:data.newFollowed};return typeof callback==="function"?callback():void 0}).fail(function(){return error(8)});return true;default:error(7);return null}}else{error(7);return null}};bind("win",["fn.unfold","fn.shut","curtain","fn.ensure","ensure"]);$.fn.card=function(param,callback){var c,f,p,t;f={name:"$.fn.card()",win:$$("#win-info"),direction:"auto",callback:callback};f.mainer=f.win.children("div.mainer");switch($.type(p=param)){case"string":f.direction=$.trim(p);break;case"function":f.callback=p}c=".card";t=f.win.data().timer;return this.each(function(){var obj;obj=$(this);return obj.off("mouseenter"+c).on("mouseenter"+c,function(){clearTimeout(t);return t=setTimeout(function(){return $.require("win",function(){return system.func.showCard(obj,f)})},200)}).off("mouseleave"+c).on("mouseleave"+c,function(){clearTimeout(t);return $$("#win-info").mouseleave()})})};bind("etc",["followUser","fn.readyPager","setParam","fn.edit","fn.share"]);$.mid=function(){return Math.random().toString(36).substring(2)};$.rnd=function(){var p,r;p=1<=arguments.length?__slice.call(arguments,0):[];r=Math.random();switch(p.length){case 1:switch($.type(p[0])){case"number":return r*p[0]|0;case"array":return p[0][r*p[0].length|0]}break;case 2:return p[0]+r*(p[1]-p[0])|0;default:return r*2|0}};$.makePager=function(param){var f,i,p,_i,_j,_ref,_ref1,_ref2,_ref3;f={num:1,count:0,size:10,"long":5};if(param){$.extend(f,param)}p={total:f.totalPage||Math.ceil(f.count/f.size),num:f.num};if(p.total>1){p.fore=p.num!==1?'<span class="pager pager-fore" data-page="'+(p.num-1)+'"><i class="icon icon-chevron-left" title="上一页"></i></span>':"";p.hind=p.num!==p.total?'<span class="pager pager-hind" data-page="'+((p.num|0)+1)+'"><i class="icon icon-chevron-right" title="下一页"></i></span>':"";p.last=p.num!==p.total?'<span class="pager pager-first" data-page="'+p.total+'"><i class="icon icon-step-forward" title="最末"></i></span>':"";p.first=p.num!==1?'<span class="pager pager-last" data-page="'+1+'"><i class="icon icon-step-backward" title="最初"></i></span>':"";p.here='<span class="pager pager-here active" data-page="'+p.num+'">'+p.num+"</span>";p.fores="";for(i=_i=_ref=p.num-1,_ref1=p.num-f.long;_i>_ref1;i=_i+=-1){if(i>=1){p.fores='<span class="pager pager-hinds" data-page="'+i+'">'+i+"</span>"+p.fores}}p.hinds="";for(i=_j=_ref2=p.num+1,_ref3=p.num+f.long;_j<_ref3;i=_j+=1){if(i<=p.total){p.hinds+='<span class="pager pager-fores" data-page="'+i+'">'+i+"</span>"}}return p.html='<div id="'+(f.id||"")+'" class="area-pager '+(f["class"]||"")+'">'+(f.before||"")+p.first+p.fore+p.fores+p.here+p.hinds+p.hind+p.last+'<span class="hint">当前位置：'+(!f.addon?p.num:'<input class="ipt-pager" type="number" value="'+p.num+'" data-max="'+p.total+'">')+"/"+p.total+"页"+(f.addon?'<button class="btn mini btn-pager">跳页</button>':"")+"</span>"+(f.after||"")+'<span class="clearfix"></span> </div>'}else{return""}};bind("hash",["fn.hashchange","route","setHash"]);bind("flash",["fn.flash"]);window.swfobject={embedSWF:function(){var p;p=1<=arguments.length?__slice.call(arguments,0):[];return $.require("flash",function(){return swfobject.embedSWF.apply(swfobject,p)})}};bind("qrcode",["fn.qrcode"]);bind("jqueryui",["fn.draggable","fn.droppable","fn.selectable","fn.sortable"]);$.parseChannel=function(param){var a,c,list,_i,_j,_len,_len1;list=$.parseChannel.list||[];switch($.type(param)){case"number":for(_i=0,_len=list.length;_i<_len;_i++){a=list[_i];if(!(a[0]===param)){continue}c=a[1];break}return c||"未知频道";case"string":for(_j=0,_len1=list.length;_j<_len1;_j++){a=list[_j];if(!(a[1]===param)){continue}c=a[0];break}return c||1;default:return"未知频道"}};$.parseColor=function(string){var c,i,l,p,_i,_j;switch($.type(p=string)){case"string":l=p.length;c=[p.charCodeAt(0),p.charCodeAt(l*.5|0),p.charCodeAt(l-1)];for(i=_i=0;_i<=2;i=++_i){c[i]=c[i].toString();c[i]=c[i].substr(c[i].length-2)*2.55|0}if(c[1]>127){c[1]=255-c[1]}for(i=_j=0;_j<=2;i=++_j){c[i]=c[i].toString(16);if(c[i].length<2){c[i]="0"+c[i]}}return"#"+c.join("");default:return"#333333"}};$.parseGet=function(param){var func;func={name:"$.parseGet()"};if(param){switch($.type(param)){case"string":func.text=param;break;case"object":$.extend(func,param);func.name="$.parseGet()"}func.text=func.text.search(/(?:\[[^\]]*?\[)|(?:\][^\[]*?\])/)===-1?func.text:func.text.replace(/\[.*?\]/g,"").replace(/\[|\]/g,"");func.text=func.text.replace(/&nbsp;/g," ").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/(?:&lt;|&gt;)/g,"").replace(/&lt;br\/&gt;/g,"").replace(/<br\s?\/?>/g,"").replace(/\r/g,"\n").replace(/\n{2,}/g,"\n");if(func.text.search(/\n+/)!==-1){func.text.replace(/\n+/,"")}if(window.ubb2html){func.text=window.ubb2html(func.text)}func.text=func.text.replace(/\[ac\=(\S+?)\](\S+?)\[\/ac\]/g,'<a class="ac title btn" data-aid="$1" href="/v/ac$1" target="_blank"><i class="icon icon-play-circle"></i>$2</a>').replace(/\[aa\=(\S+?)\](\S+?)\[\/aa\]/g,'<a class="aa btn" href="/a/aa$1" target="_blank" title="该链接通向AcFun合辑"><i class="icon icon-list"></i>$2</a>').replace(/\[sm\=(\S+?)\](\S+?)\[\/sm\]/g,'<a class="sm btn" href="http://www.nicovideo.jp/watch/sm$1" target="_blank" title="该链接通向ニコニコ动画"><i class="icon icon-film"></i>$2</a>').replace(/\[email\](\S+?)\[\/email\]/g,'<a class="email btn" href="mailto:$1" target="_blank" title="点击以发送邮件"><i class="icon icon-envelope"></i>$1</a>').replace(/\[wiki\=(\S+?)\](\S+?)\[\/wiki\]/g,'<a class="wiki btn" href="http://wiki.acfun.tv/index.php/$1" target="_blank" title="该链接通向AC百科"><i class="icon icon-tag"></i>$2</a>').replace(/\[emot\=(\S+?)\,(\S+?)\/\]/g,'<img class="emotion" src="'+system.path.short+'/umeditor/dialogs/emotion/images/$1/$2.gif">');if(!func.showImage){func.text=func.text.replace(/\[img\](\S+?)\[\/img\]/g,'<a class="btn btn-img" href="$1" target="_blank" title="点击以浏览图像"><i class="icon icon-picture-o"></i>图像</a>').replace(/\[img\=(\S+?)\](\S+?)\[\/img\]/g,'<a class="btn btn-img" href="$2" target="_blank" title="$1"><i class="icon icon-picture-o"></i>$1</a>')}else{func.text=func.text.replace(/\[img\](\S+?)\[\/img\]/g,'<a class="thumb" href="$1" target="_blank" title="点击以浏览图像"><img class="preview" src="$1"></a>').replace(/\[img\=(\S+?)\](\S+?)\[\/img\]/g,'<a class="thumb" href="$2" target="_blank" title="$1"><img class="preview" src="$2"></a>')}func.text=func.text.replace(/\[at\]([\s\S]+?)\[\/at\]/g,'<a class="name" target="_blank"href="/member/findUser.aspx?userName=$1">@$1</a>').replace(/\[\/?back.*?\]/g,"").replace(/\[username\]([\s\S]+?)\[\/username\]/g,'<a  class="name" target="_blank" href="/member/findUser.aspx?userName=$1">$1</a>').replace(/\[.*?\]/g,"").replace(/([\s\W\_])on\w+?\s*?\=/g,"$1data-event=");return $.trim(func.text)}else{return""}};$.parseJson=function(data){var d,f;f=function(p){var e;try{return $.parseJSON(p)}catch(_error){e=_error;return null}};switch($.type(d=data)){case"string":return f(d);case"object":return d;default:return null}};$.parsePost=function(param){var a,arr,b,fs,func,list,mails,r,_i,_j,_k,_len,_len1,_len2,_ref;func={name:"$.parsePost()",text:""};if(param){switch($.type(param)){case"string":case"number":func.text=param;break;default:$.i("["+func.name+"]#7")}}if((_ref=func.text)!=null?_ref.length:void 0){func.text="[mimiko]"+func.text.replace(/<span\sstyle="text\-decoration\:underline;">([\s\S]+?)<\/span>/g,"[u]$1[/u]").replace(/<span\sstyle="text\-decoration:line\-through;">([\s\S]+?)<\/span>/g,"[s]$1[/s]").replace(/<img[^>]*?src="[^>]*?\/um?editor\/dialogs\/emotion\/images\/(\w+?)\/(\d+?)\.gif".*?>/g,"[emot=$1,$2/]");mails=func.text.match(/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/g);if(mails!=null?mails.length:void 0){func.text=func.text.replace(/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/g,"[mimiko-mail-mark]")}if(window.html2ubb){func.text=window.html2ubb(func.text)}func.text=func.text.replace(/<br\s?\/?>/g,"").replace(/(http:\/\/.*?\.(?:jpg|jpeg|png|gif))(?!\[)/g,"[img]$1[/img]").replace(/\[url\](.*?\.(?:jpg|jpeg|png|gif))\[\/url\]/g,"[img]$1[/img]").replace(/\[url\]\[img\](.*?)\[\/img\]\[\/url\]/g,"[img]$1[/img]").replace(/@([^\s<>\[\]\(\)\{\}]{2,20})/g,"[at]$1[/at]").replace(/\[ac(\d+?)\]/g,"[ac=$1]ac$1[/ac]").replace(/([^\w=\[\]\/])ac(\d+)/g,"$1[ac=$2]ac$2[/ac]").replace(/\[aa(\d+?)\]/g,"[aa=$1]ac$1[/aa]").replace(/([^\w=\[\]\/])aa(\d+)/g,"$1[aa=$2]aa$2[/aa]").replace(/\[sm(\d+?)\]/g,"[sm=$1]sm$1[/sm]").replace(/([^\w=\[\]\/])sm(\d+)/g,"$1[sm=$2]sm$2[/sm]").replace(/\[wiki([\s\S]+?)\]/g,"[wiki=$1]$1[/wiki]").replace(/\[mimiko\]/g,"");if(mails!=null?mails.length:void 0){for(_i=0,_len=mails.length;_i<_len;_i++){a=mails[_i];func.text=func.text.replace(/\[mimiko\-mail\-mark\]/,"[email]"+a+"[/email]")}}fs=func.text.match(/\[size.*?\]/g);if(fs!=null?fs.length:void 0){func.text=func.text.replace(/\[size.*?\]/g,"[mimiko-fontsize-mark]");list=[10,12,16,18,24,32,48];for(_j=0,_len1=fs.length;_j<_len1;_j++){a=fs[_j];b=a.match(/\d+/)[0]|0;if($.inArray(b,list)<0){a="[size=14px]"}func.text=func.text.replace(/\[mimiko\-fontsize\-mark\]/,a)}}}func.text=func.text.replace(/\[img\].+\/um?editor\/dialogs\/emotion\/images\/(\w+?)\/(\d+?)\.gif\[\/img\]/g,"[emot=$1,$2/]");list=["b","i","u","s","color"];for(_k=0,_len2=list.length;_k<_len2;_k++){a=list[_k];r=new RegExp("\\["+a,"ig");arr=func.text.match(r);if(arr!=null?arr.length:void 0){r=new RegExp("\\[\\/"+a,"ig");b=func.text.match(r);if(!b||arr.length!==b.length){func.text=func.text.replace(/\[.*?\]/g,"")}}}if(func.text.search(/\[[^\]]+\[/)>=0||func.text.search(/\][^\[]+\]/)>=0){$.info("error::["+func.name+"]#7");func.text=func.text.replace(/\[.*?\]/g,"")}return $.trim(func.text)};$.parsePts=function(number){var n;if((n=(number||0)|0)>=1e5){return(n*.001|0)/10+"万"}else{return n.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}};$.parseSafe=function(text){var t;if(t=text){t=t.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g,"");if(window.Worker){return new Option(t).innerHTML}else{if(!$$()["#item-safe-parse"]){$$("#stage").append('<div id="item-safe-parse" class="hidden"></div>')}return $$("#item-safe-parse").text(t).html()}}else{return""}};$.parseString=function(data){var d,e;switch($.type(d=data)){case"string":return d;case"number":return d.toString();case"array":return JSON.stringify({_obj:d}).replace(/\{(.*)\}/,"$1").replace(/"_obj":/,"");case"object":return JSON.stringify(d);case"boolean":return d.toString();case"undefined":return"undefined";case"null":return"null";default:try{return d.toString()}catch(_error){e=_error;return""}}};$.parseTime=function(param){var trans;trans=function(t){var dayAgo,dt,dtNow,hrAgo,hrMin,longAgo,longLongAgo,minAgo,secAgo,ts,tsDistance,tsNow;dt=new Date(t);ts=dt.getTime();dtNow=new Date;tsNow=dtNow.getTime();tsDistance=tsNow-ts;hrMin=dt.getHours()+"时"+(dt.getMinutes()<10?"0":"")+dt.getMinutes()+"分";longAgo=dt.getMonth()+1+"月"+dt.getDate()+"日(星期"+["日","一","二","三","四","五","六"][dt.getDay()]+") "+hrMin;longLongAgo=dt.getFullYear()+"年"+longAgo;if(tsDistance<0){return"刚刚"}else{if(tsDistance/1e3/60/60/24/365|0>0){return longLongAgo}else{if((dayAgo=tsDistance/1e3/60/60/24)>3){if(dt.getFullYear()!==dtNow.getFullYear()){return longLongAgo}else{return longAgo}}else{if((dayAgo=(dtNow.getDay()-dt.getDay()+7)%7)>2){return longAgo}else{if(dayAgo>1){return"前天 "+hrMin}else{if((hrAgo=tsDistance/1e3/60/60)>12){return(dt.getDay()!==dtNow.getDay()?"昨天 ":"今天 ")+hrMin}else{if((hrAgo=tsDistance/1e3/60/60%60|0)>0){return hrAgo+"小时前"}else{if((minAgo=tsDistance/1e3/60%60|0)>0){return minAgo+"分钟前"}else{if((secAgo=tsDistance/1e3%60|0)>0){return secAgo+"秒前"}else{return"刚刚"}}}}}}}}}};return trans($.timeStamp(param))};$.parseTemp=function(string,object){var k,s,v;s=string;for(k in object){v=object[k];s=s.replace(new RegExp("\\["+k+"\\]","g"),v)}return s};$.timeStamp=function(param){var a,b,c,d,i,p,text,_i;switch($.type(p=param)){case"number":return p;case"string":text=$.trim(p);if(text.search(/[\s\.\-\/]/)!==-1){if(text.search(/\:/)!==-1){a=text.split(" ");if(a[0].search(/\:/)===-1){b=a[0].replace(/[\-\/]/g,".").split(".");c=a[1].split(":")}else{b=a[1].replace(/[\-\/]/g,".").split(".");c=a[0].split(":")}}else{b=text.replace(/[\-\/]/g,".").split(".");c=[0,0,0]}for(i=_i=0;_i<=2;i=++_i){b[i]=b[i]|0;c[i]=(c[i]||0)|0}d=new Date;d.setFullYear(b[0],b[1]-1,b[2]);d.setHours(c[0],c[1],c[2]);return d.getTime()}else{return $.now()}break;default:return $.now()}};$.fn.loadin=function(){return this.each(function(){return $(this).attr({src:$(this).data().src})})};$.preload=function(param,callback){var arr,next,p;next=function(){var i,l,loader,mid;$$("#stage").append('<img id="preloader-'+(mid=$.mid())+'" class="hidden">');loader=$("#preloader-"+mid);l=function(src){var check;check=function(){if(i<arr.length){return l(arr[i])}else{loader.remove();return typeof callback==="function"?callback():void 0}};if(src.toLowerCase().search(/png|jpg|gif|jepg/)!==-1){return loader.off().one("load",function(){i++;return setTimeout(check,20)}).one("error",function(){return loader.load()}).attr({src:src})}else{i++;return check()}};return l(arr[i=0])};switch($.type(p=param)){case"string":arr=[p];return next();case"array":arr=p;return next();default:return typeof callback==="function"?callback():void 0}};$.delay=function(id,delay,callback){var c,error,f,func,now,_base,_base1,_name;func={name:"$.delay()",id:id,delay:delay,callback:callback};error=function(e){return $.i("["+func.name+"]#"+e)};if(func.id&&func.delay>=0&&func.callback){if((_base=c=(_base1=$.delay).cache!=null?_base1.cache:_base1.cache={})[_name=func.id]==null){_base[_name]={time:0,timer:null}}now=$.now();f=function(){c[func.id].time=$.now();return typeof func.callback==="function"?func.callback():void 0};if(now-c[func.id].time>func.delay){return f()}else{clearTimeout(c[func.id].timer);return c[func.id].timer=setTimeout(f,func.delay)}}else{return error(7)}};$.require=function(p,c){var error,f,fix,func,id,r,salt,_base;func={name:"$.require()"};error=function(e){return $.i("["+func.name+"]#"+e)};fix=[(system.debug?".js":".min.js")+(salt=$.salt()),".css"+salt];r=(_base=$.require).cache!=null?_base.cache:_base.cache={};bind=function(t,s){var url;if(r[t]){if(r[t]===1){return typeof c==="function"?c():void 0}else{return r[t].add(c)}}else{(r[t]=$.Callbacks("once")).add(c);url=s?system.path.short+"/script/"+s+".js":system.path.short+"/script/require/"+t+fix[0];return $.getScript(url,function(){r[t].fire();return r[t]=1})}};switch(p){case"comm":if(r.comm){return typeof c==="function"?c():void 0}else{id="style-require-comm";if(!$("#"+id).length){$$("head").append('<link id="'+id+'" href="'+system.path.short+"/project/homura/style/comm"+fix[1]+'" rel="stylesheet">')}return $.getScript(system.path.short+"/project/homura/script/comm"+fix[0],function(){r.comm=1;return typeof c==="function"?c():void 0})}break;case"qrcode":return bind("qrcode","jquery.qrcode.min");case"jqueryui":return bind("jqueryui","jquery.ui.min");case"transit":return bind("transit","jquery.transit.min");case"chart":return bind("chart","chart.min");case"canvas":if(r.canvas){return typeof c==="function"?c():void 0}else{f=function(){r.canvas=1;return typeof c==="function"?c():void 0};if($("<canvas>")[0].getContext!=null){return f()}else{return $.getScript(system.path.short+"/script/excanvas.min.js",f)}}break;case"editor":if(r.editor){return typeof c==="function"?c():void 0}else{id="style-require-editor";if(!$("#"+id).length){$$("head").append('<link id="'+id+'" href="'+system.path.short+'/umeditor/themes/ac/css/umeditor.css" rel="stylesheet">')}return $.getScript(system.path.short+"/umeditor/umeditor.config.min.js",function(){return $.getScript(system.path.short+"/umeditor/umeditor.min.js",function(){r.editor=1;return typeof c==="function"?c():void 0})})}break;case"ready":if(r.ready){return typeof c==="function"?c():void 0}else{return system.func.ready(function(){r.ready=1;return typeof c==="function"?c():void 0})}break;default:return bind(p)}}}).call(this);(function(){var __indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};system.func.checkBrowser=function(callback){var fin;fin=function(){var a,arr,_i,_len,_ref;arr=[];_ref=["rgba","borderradius"];for(_i=0,_len=_ref.length;_i<_len;_i++){a=_ref[_i];arr.push(system.browser[a]?a:"no-"+a)}$("html").addClass(arr.join(" "));window.Modernizr=null;system.func.checkBrowser=null;return callback()};if(cache.browser&&system.st-cache.browser.date<14*864e5){system.browser=cache.browser;return fin()}else{return $.getScript(system.path.short+"/script/modernizr.min.js",function(){var b,ua,_ref;cache.browser=window.Modernizr;ua=navigator.userAgent.toLowerCase();_ref=(b=ua.match(/msie ([\d.]+)/))?["msie",b[1]]:(b=ua.match(/trident.*rv\:([\d.]+)/))?["msie",b[1]]:(b=ua.match(/firefox\/([\d.]+)/))?["firefox",b[1]]:(b=ua.match(/chrome\/([\d.]+)/))?["chrome",b[1]]:(b=ua.match(/opera.([\d.]+)/))?["opera",b[1]]:(b=ua.match(/version\/([\d.]+).*safari/))?["safari",b[1]]:["unknown","unknown"],cache.browser.name=_ref[0],cache.browser.version=_ref[1];cache.browser.date=system.st;$.save("cache");system.browser=cache.browser;return fin()})}};system.func.ready=function(callback){var cache,config,user;config=window.config;user=window.user;cache=window.cache;(function(){var a;a=$.parseJson(store.get("config"));if(a&&a.ver===config.ver){return $.extend(config,a)}else{return $.save("config")}})();(function(){var a;a=$.parseJson(store.get("user"));if(a&&a.ver===user.ver){$.extend(user,a)}else{$.save("user")}return user.avatar=$.cookie("ac_userimg")||system.path.short+"/style/image/avatar.jpg"})();(function(){var f;(f=function(){var a;a=$.parseJson(store.get("cache"));if(a&&a.ver===cache.ver){return $.extend(cache,a)}else{return $.save("cache")}})();return setInterval(f,6e4)})();(function(){var a,b,v,_i,_j,_len,_len1,_ref,_ref1,_ref2,_ref3,_results;if(system.url.search(/\?/)!==-1){a=system.url.replace(/.*\?/,"").split("&");for(_i=0,_len=a.length;_i<_len;_i++){v=a[_i];b=[v.replace(/=[\s\S]+/,""),v.replace(/[\s\S]+?=/,"")];if(((_ref=b[0])!=null?_ref.length:void 0)&&((_ref1=b[1])!=null?_ref1.length:void 0)){system.param[b[0]]=b[1].replace(/[\(\)<>\[\]\{\}'"]/g,"")}}}if(window.location.hash){a=window.location.hash.toString().replace(/\#/,"").split(";");_results=[];for(_j=0,_len1=a.length;_j<_len1;_j++){v=a[_j];b=[v.replace(/=[\s\S]+/,""),v.replace(/[\s\S]+?=/,"")];if(((_ref2=b[0])!=null?_ref2.length:void 0)&&((_ref3=b[1])!=null?_ref3.length:void 0)){_results.push(system.hash[b[0]]=b[1].replace(/[\(\)<>\[\]\{\}'"]/g,""))}else{_results.push(void 0)}}return _results}})();(function(){var t,win;win=$$("#win-info");t=win.data().timer;if(win.length){return win.on("mouseenter",function(){return clearTimeout(t)}).on("mouseleave",function(){clearTimeout(t);return t=setTimeout(function(){return win.css({display:"none"})},200)})}else{return $.i("[#win-info]#3")}})();(function(){var area;area=$$("#area-window");if(area.length){return area.delegate("div.win-hint","click",function(){var win;win=$(this);return win.stop(false,true).transition({opacity:0},200,function(){win.css({display:"none"});if(!win.is("#win-hint")){return win.remove()}})})}else{return $.i("[#area-window]#3")}})();(function(){var body,mainer,resize,root,stage;root=$(window);body=$$("body");stage=$$("#stage");mainer=$$("#mainer");root.resize(function(){return $.delay("stageResize",200,resize)});return(resize=function(){(function(){var h;h=mainer.height()+(root.height()||body.height())-stage.height();if(h>0){return mainer.css({"min-height":h})}})();return function(){var elem,inner;elem=$$("#btn-top-shortcut");inner=$$("#footer-inner");if(elem.length){return elem.css({left:inner.offset().left+inner.width()+16})}}()})()})();(function(){var elem,fb;elem=$$("#btn-top-shortcut");if(elem.length){elem.data({timer:null,viewing:false});fb=elem.find("a.feedback");if(fb.length){return fb.attr({href:fb.attr("href")+"#from="+location.href.replace(/[#\?].*/,"")})}}})();(function(){var guide,inner,simple,sub,subInner,tabs;guide=$$("#guide");sub=$$("#sub-guide");inner=$$("#guide-inner");subInner=$$("#sub-guide-inner");simple=guide.hasClass("simple")?true||false:void 0;tabs=simple?inner.find("div.l:eq(0)>a:not(.only)"):inner.find("div.b>div.l>a:not(.only)");sub.data({timer:null});tabs.mouseenter(function(){var tab;tab=$(this);clearTimeout(sub.data().timer);return sub.data().timer=setTimeout(function(){var channel,left,unit;tab.addClass("active").siblings(".active").removeClass("active");channel=tab.data().channel;unit=subInner.find("div.channel-"+channel);unit.addClass("active").removeClass("hidden");left=tab.position().left-unit.width()*.2;if(left<0){left=0}unit.css({opacity:0,left:left}).stop(false,true).transition({opacity:1},200).siblings(".active").removeClass("active").addClass("hidden");return sub.addClass("active")},50)}).mouseleave(function(){clearTimeout(sub.data().timer);return sub.data().timer=setTimeout(function(){tabs.filter(".active").removeClass("active");return sub.removeClass("active")},200)});sub.mouseenter(function(){return clearTimeout(sub.data().timer)}).mouseleave(function(){clearTimeout(sub.data().timer);return sub.data().timer=setTimeout(function(){tabs.filter(".active").removeClass("active");return sub.removeClass("active")},200)});(function(){var area,cont,elem,f,hideHint,link,mainer,thumb,win;elem=$$("#a-avatar-guide");win=$$("#win-info-guide");mainer=win.find("div.mainer");cont=mainer.children("div.b");area=$$("#area-user-guide");thumb=$$("#a-avatar-guide");link=thumb.add("#win-info-guide>div.mainer>div.c>a");elem.data({timer:null});f=function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){return win.stop(false,true).addClass("hidden")},500)};hideHint=function(){return elem.find("p.info-hint").text(0).addClass("hidden")};elem.mouseenter(function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){$$("#win-history-guide").addClass("hidden");$$("#win-post-guide").addClass("hidden");return win.css({opacity:0,top:simple?40:72}).removeClass("hidden").stop(false,true).transition({opacity:1,top:simple?48:80},100)},200)}).mouseleave(f);win.mouseenter(function(){return clearTimeout(elem.data().timer)}).mouseleave(f);if($.check("online")){$$("#a-name-guide").text($.parseSafe(user.name));elem.removeClass("hidden").children("img.avatar").attr({src:$.parseSafe(user.avatar)}).removeClass("hidden");$$("#a-logout-guide").attr({href:"/logout.aspx?returnUrl="+$.parseSafe(location.href.replace(/\?.*/,"").replace(/#.*/,""))});thumb.click(hideHint);mainer.delegate("div.b a, div.c a","click",hideHint);return $.check("unread",function(){var html,n,url;html="";n=0;url="";if(user.unread.push){html+='<a class="unit" href="/member/#area=push" target="_blank"> <i class="icon icon-play-circle"></i> 您有<span class="pts">'+user.unread.push+"</span>条新推送 </a>";n+=parseInt(user.unread.push);url="/member/#area=push"}if(user.unread.fan){html+='<a class="unit" href="/member/#area=followers" target="_blank"> <i class="icon icon-user"></i> 您有<span class="pts">'+user.unread.fan+"</span>个新听众 </a>";n+=parseInt(user.unread.fan);url="/member/#area=followers"}if(user.unread.at){html+='<a class="unit" href="/member/#area=mention" target="_blank"> <i class="icon icon-at"></i> 您被召唤了<span class="pts">'+user.unread.at+"</span>次 </a>";n+=parseInt(user.unread.at);url="/member/#area=mention"}if(user.unread.mail){html+='<a class="unit" href="/member/#area=mail" target="_blank"> <i class="icon icon-envelope"></i> 您有<span class="pts">'+user.unread.mail+"</span>条新私信 </a>";n+=parseInt(user.unread.mail);url="/member/#area=mail"}if(url){link.attr({href:url})}if(!html.length){html='<p class="alert">暂未有任何信息。</p>'}cont.html(html);if(n>0){if(n>99){n="99+"}return elem.find("p.info-hint").text(n).removeClass("hidden")}else{return hideHint()}})}else{return $$("#a-login-guide").removeClass("hidden")}})();(function(){var cont,elem,f,win;elem=$$("#a-history-guide");win=$$("#win-history-guide");cont=win.find("div.mainer>div.b");elem.data({timer:null});f=function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){return win.stop(false,true).addClass("hidden")},500)};elem.mouseenter(function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){var a,html,i,len,temp,_i,_len,_ref,_ref1,_ref2;$$("#win-info-guide").addClass("hidden");$$("#win-post-guide").addClass("hidden");html="";len=(_ref=(_ref1=cache.history.views)!=null?_ref1.length:void 0)!=null?_ref:null;if(len){temp='<a class="unit" href="[url]" target="_blank" title="[title]"> <p class="title">[title]</p> <p class="desc">浏览于<span class="time">[time]</span></p> </a>';_ref2=simple?[0,1,2,3]:[0,1,2,3,4,5];for(_i=0,_len=_ref2.length;_i<_len;_i++){i=_ref2[_i];a=cache.history.views[len-i];if(a!=null){html+=$.parseTemp(temp,{url:(a.type&&a.type==="album"?"/a/aa":"/v/ac")+a.aid,title:a.title,time:$.parseTime(a.time)})}}}else{html='<p class="alert warning"> 尚未记录任何历史信息。 </p>'}cont.html(html);return win.css({opacity:0,top:simple?40:72}).removeClass("hidden").stop(false,true).transition({opacity:1,top:simple?48:80},100)},200)}).mouseleave(f);return win.mouseenter(function(){return clearTimeout(elem.data().timer)}).mouseleave(f)})();(function(){var elem,f,win;elem=$$("#a-post-guide");win=$$("#win-post-guide");elem.data({timer:null});f=function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){return win.stop(false,true).addClass("hidden")},500)};elem.mouseenter(function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){$$("#win-info-guide").addClass("hidden");$$("#win-history-guide").addClass("hidden");return win.css({opacity:0,top:simple?40:72}).removeClass("hidden").stop(false,true).transition({opacity:1,top:simple?48:80},100)},200)}).mouseleave(f);return win.mouseenter(function(){return clearTimeout(elem.data().timer)}).mouseleave(f)})();return function(){var fold,gh,scroll,shortcut;shortcut=$$("#btn-top-shortcut");gh=simple?48:120;fold=function(){return guide.stop(false,true).transition({top:-gh},200,function(){return guide.removeClass("float").css({top:0}).data().viewing=false})};scroll=function(){var top,wh;top=$(document).scrollTop();wh=$(window).innerHeight();if(top>=gh&&wh>=864&&!system.gate.guideFloatDisabled&&config.globe.guideFloatAllowed){if(top>guide.data().top){if(guide.data().viewing&&!guide.data().hover){fold()}}else{if(!guide.data().viewing){guide.css({top:-gh}).addClass("float").stop(false,true).transition({top:0},200,function(){return guide.data().viewing=true})}$.delay("guideScroll",2e3,function(){if(guide.data().viewing){return fold()}})}}guide.data().top=top;if(top>wh){if(!shortcut.data().viewing){return shortcut.css({opacity:0}).removeClass("hidden").stop(false,true).transition({opacity:1},200,function(){return shortcut.data().viewing=true})}}else{if(shortcut.data().viewing){return shortcut.stop(false,true).transition({opacity:0},200,function(){return shortcut.addClass("hidden").data().viewing=false})}}};guide.data({timer:null,top:0,viewing:true,hover:false}).mouseenter(function(){var _ref;guide.data().hover=true;if((_ref=$.delay.cache)!=null?_ref.guideScroll:void 0){return clearTimeout($.delay.cache.guideScroll.timer)}}).mouseleave(function(){var _ref;guide.data().hover=false;if((_ref=$.delay.cache)!=null?_ref.guideScroll:void 0){return $.delay.cache.guideScroll.timer=setTimeout(function(){if(guide.data().viewing){return fold()}},2e3)}});return $(window).scroll(function(){return $.delay("guideScroll",200,scroll)})}()})();$("#area-search-guide input.ipt-search").one("focus",function(){var dropdown,form,ipt,placeholder;form=$$("#area-search-guide");ipt=form.find("input.ipt-search");dropdown=form.find("ul.menu-search");placeholder=ipt.attr("placeholder")||"搜索";if(ipt.length){form.data({timer:null,port:null});if(!window.Worker){ipt.val(placeholder)}dropdown.css({left:ipt.offset().left-form.offset().left,top:ipt.offset().top-form.offset().top+36,"min-width":ipt.width()+20}).delegate("a","click",function(){var obj;obj=$(this);return ipt.val(obj.find("span.cont").text())});return ipt.focus(function(){if(ipt.val()===placeholder){ipt.val("")}ipt.keyup();return dropdown.css({display:"block",opacity:0}).stop(false,true).transition({opacity:1},200)}).blur(function(){ipt.val($.trim(ipt.val()));if(!$.trim(ipt.val()).length&&!window.Worker){ipt.val(placeholder)}return dropdown.stop(false,true).transition({opacity:0},200,function(){return dropdown.css({display:"none"})})}).keydown(function(e){if(e.which===13||e.which===10){return ipt.val($.trim(ipt.val()))}}).keyup(function(e){var i,obj,temp,val;obj=dropdown.children("li.active");if(e.which===38||e.which===40){e.preventDefault();if(!obj.length){system.tv=e.which===38?"last":"first";dropdown.children("li:"+system.tv).addClass("active")}else{i=e.which===38?obj.index()-1:obj.index()+1;if(i<0){i=dropdown.children("li").length-1}if(i>=dropdown.children("li").length){i=0}obj.removeClass("active");dropdown.children("li:eq("+i+")").addClass("active")}return ipt.val(dropdown.children("li.active").find("span.cont").text())}else{val=$.trim(ipt.val());temp='<li><a href="http://wiki.acfun.tv/index.php/搜索" target="_blank">获取搜索帮助</a></li>';if(val.length){clearTimeout(form.data().timer);return form.data().timer=setTimeout(function(){var _ref;if((_ref=form.data().port)!=null){_ref.abort()}return form.data().port=$.getScript("http://search.acfun.tv/suggest?cd=1&q="+encodeURI(val)).done(function(){var a,d,html,_i,_len,_ref1;d=$.parseJson($.parseString(system.tv));if((d!=null?d.status:void 0)===200){if(d.data.length){html="";_ref1=d.data[0].alternatives;for(_i=0,_len=_ref1.length;_i<_len;_i++){a=_ref1[_i];html+='<li><a href="/search/#query='+a+'" target="_blank"><span class="cont">'+a+"</span></a></li>"}}else{html=temp}}else{html=temp}return dropdown.html(html)}).fail(function(){return dropdown.html(temp)})},500)}else{return dropdown.html(temp)}}}).val("").focus()}});$.parseChannel.list=[[1,"动画"],[106,"动画短片"],[107,"MAD·AMV"],[108,"MMD·3D"],[67,"新番连载"],[109,"旧番补档"],[120,"国产动画"],[113,"动画专题"],[58,"音乐"],[101,"演唱·乐器"],[102,"宅舞"],[103,"Vocaloid"],[105,"流行音乐"],[104,"ACG音乐"],[114,"音乐专题"],[59,"游戏"],[83,"游戏集锦"],[84,"实况解说"],[71,"Flash游戏"],[72,"Mugen"],[85,"英雄联盟"],[115,"游戏专题"],[60,"娱乐"],[86,"生活娱乐"],[87,"鬼畜调教"],[88,"萌宠"],[89,"美食"],[121,"原创网络剧"],[116,"娱乐专题"],[70,"科技"],[90,"科学技术"],[91,"数码"],[92,"军事"],[122,"汽车"],[119,"科技专题"],[69,"体育"],[93,"惊奇体育"],[94,"足球"],[95,"篮球"],[118,"体育专题"],[68,"影视"],[96,"电影"],[97,"剧集"],[98,"综艺"],[99,"特摄·布袋戏"],[100,"纪录片"],[117,"影视专题"],[63,"文章"],[110,"文章综合"],[73,"工作·情感"],[74,"动漫文化"],[75,"漫画·小说"],[76,"页游资料"],[77,"1区"],[78,"21区"],[79,"31区"],[80,"41区"],[81,"文章里区(不审)"],[82,"视频里区(不审)"],[42,"图库"]];$.parseChannel.map={1:[106,107,108,67,109,120,113],58:[101,102,103,105,104,114],59:[83,84,71,72,85,115],60:[86,87,88,89,121,116],70:[90,91,92,122,119],69:[93,94,95,118],68:[96,97,98,99,100,117],110:[63,73,74,75],0:[76,77,78,79,80,81,82,42]};(function(){var f;if(user.online&&system.url.search(/acfun/)!==-1){(f=function(){return $.get("/online.aspx",{uid:user.uid}).done(function(data){if(data.success){user.level=data.level|0;user.ban=data.isdisabled;user.onlineTime=data.duration|0;return $.save("user")}})})();return setInterval(f,3e5)}})();if(window._hmt==null){window._hmt=[]}$$("#stage").after('<script src="//hm.baidu.com/hm.js?bc75b9260fe72ee13356c664daa5568c"></script>');if(user.online&&user.level>1){$("#sub-guide-inner .unit a.hidden").removeClass("hidden")}return system.func.checkBrowser(function(){$.get("/notice.aspx").done(function(data){var a,arr,b,block,html,i,inner,temp,v,_i,_len,_ref;if(data.success){if(data.data.registerOn){system.regable=1}arr=data.data.list;if(arr.length){if(cache.notice==null){cache.notice=[]}block=$$("#block-notice-guide");temp=block.children("div.temp").html();inner=block.children("div.inner");html="";inner.data().length=0;for(i=_i=0,_len=arr.length;_i<_len;i=++_i){a=arr[i];if(!(i<2)){continue}if(b=a.content.match(/data\-browser="([\w\W]+?)"/)){b=b[1].split(":");if(system.browser.name===b[0]){if(b[1]){v=system.browser.version.split(".")[0];if(b[1].search(/\+/)!==-1){if(v<parseInt(b[1])){continue}}else if(b[1].search(/\-/)!==-1){if(v>parseInt(b[1])){continue}}else{if(v!==b[1]|0){continue}}}}else{continue}}if(_ref=a.time,__indexOf.call(cache.notice,_ref)>=0){continue}inner.data().length++;html+=$.parseTemp(temp,{text:a.content,time:a.time})}if(inner.data().length){inner.delegate("span.close","click",function(){var btn,elem,obj;btn=$(this);elem=btn.closest("div.item");cache.notice.unshift(btn.data().time);if(cache.notice.length>5){cache.notice=cache.notice.slice(0,5)}$.save("cache");inner.data().length--;obj=inner.data().length?elem:block;return obj.transition({opacity:0,height:0,padding:0},200,function(){return obj.remove()})}).html(html);return block.removeClass("hidden")}}}});(function(){var elem,src;elem=$$("#avatar-ac-footer");if(system.browser.borderradius&&elem.length){elem.data().src=function(){return system.path.short+"/umeditor/dialogs/emotion/images/ac/"+$.rnd(1,51)+".gif"};src=elem.data().src();return $.preload(src,function(){var html;html='<img src="'+src+'">';return elem.html(html).one("click",function(){return $.getScript(system.path.short+"/script/require/avatar"+(system.debug?".js":".min.js?date="+parseInt($.now()/864e5)+system.ver.replace(/\./g,"")))}).removeClass("hidden")})}})();if(system.debug){$.require("debug")}system.func.ready=null;return typeof callback==="function"?callback():void 0})}}).call(this);