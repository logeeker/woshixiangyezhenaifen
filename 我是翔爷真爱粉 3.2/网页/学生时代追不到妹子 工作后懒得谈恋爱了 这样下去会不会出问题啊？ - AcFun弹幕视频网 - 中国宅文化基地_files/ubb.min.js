function ubb2html(c){function g(b){return null!=b&&""!=b?!isNaN(b):!1}var b,l=[],e=0,m="10px,13px,16px,18px,24px,32px,48px".split(",");b=(""+c).replace(/[<>&"]/g,function(b){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[b]});b=b.replace(/\r?\n/g,"<br />");b=b.replace(/\[(\/?)(b|u|i|s|sup|sub)\]/gi,"<$1$2>");b=b.replace(/\[color\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/gi,'<font color="$1">');b=b.replace(/\[font\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/gi,'<font face="$1">');b=b.replace(/\[\/(color|font)\]/gi,"</font>");b=b.replace(/\[size\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/gi,function(b,a){n=a.match(/\d+/);if(n){n=n[0];n=n>48?48:n}else{n=13}return'<span style="font-size:'+n+'px;">'});b=b.replace(/\[back\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/gi,'<span style="background-color:$1;">');b=b.replace(/\[\/(size|back)\]/gi,"</span>");for(c=0;3>c;c++)b=b.replace(/\[align\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\](((?!\[align(?:\s+[^\]]+)?\])[\s\S])*?)\[\/align\]/gi,'<p align="$1">$2</p>');b=b.replace(/\[url\]\s*(((?!")[\s\S])*?)(?:"[\s\S]*?)?\s*\[\/url\]/gi,'<a href="$1">$1</a>');b=b.replace(/\[url\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]*?)\s*\[\/url\]/gi,'<a href="$1">$2</a>');b=b.replace(/\[email\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/email\]/gi,'<a href="mailto:$1">$1</a>');b=b.replace(/\[email\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]+?)\s*\[\/email\]/gi,'<a href="mailto:$1">$2</a>');b=b.replace(/\[hr\/\]/gi,"<hr />");return b=b.replace(/(^|<\/?\w+(?:\s+[^>]*?)?>)([^<$]+)/gi,function(b,a,c){return a+c.replace(/[\t ]/g,function(a){return{"	":"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"," ":"&nbsp;"}[a]})})}function html2ubb(c){function g(a,c,h,d){if(!h)return d;var a=[],c=[],f;if(f=h.match(/ face\s*=\s*"\s*([^"]+)\s*"/i))a.push("[font="+f[1]+"]"),c.push("[/font]");if(f=h.match(/ size\s*=\s*"\s*(\d+)\s*"/i))a.push("[size="+f[1]+"]"),c.push("[/size]");if(f=h.match(/ color\s*=\s*"\s*([^"]+)\s*"/i))a.push("[color="+b(f[1])+"]"),c.push("[/color]");return a.join("")+d+c.join("")}function b(a){var b;if(b=a.match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){for(a=(65536*b[1]+256*b[2]+1*b[3]).toString(16);6>a.length;)a="0"+a;a="#"+a}return a=a.replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3")}var l=/\s+src\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i,e=/\s+width\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,m=/\s+height\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,n=/(?:background|background-color|bgcolor)\s*[:=]\s*(["']?)\s*((rgb\s*\(\s*\d{1,3}%?,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\))|(#[0-9a-f]{3,6})|([a-z]{1,20}))\s*\1/i,a,o=[],j=0;a=(""+c).replace(/\s*\r?\n\s*/g,"");a=a.replace(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/gi,"");a=a.replace(/<\!--[\s\S]*?--\>/gi,"");a=a.replace(/<br(\s+[^>]*)?\/?>/gi,"\r\n");a=a.replace(/<(\/?)(b|u|i|s)(\s+[^>]*?)?>/gi,"[$1$2]");a=a.replace(/<(\/?)strong(\s+[^>]*?)?>/gi,"[$1b]");a=a.replace(/<(\/?)em(\s+[^>]*?)?>/gi,"[$1i]");a=a.replace(/<(\/?)(strike|del)(\s+[^>]*?)?>/gi,"[$1s]");a=a.replace(/<(\/?)(sup|sub)(\s+[^>]*?)?>/gi,"[$1$2]");a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,g);a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,g);a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,g);for(c=0;3>c;c++)a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color|background|background-color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,function(a,c,h,d){var a=h.match(/(?:^|;)\s*font-family\s*:\s*([^;]+)/i),c=h.match(/(?:^|;)\s*font-size\s*:\s*([^;]+)/i),f=h.match(/(?:^|;)\s*color\s*:\s*([^;]+)/i),h=h.match(/(?:^|;)\s*(?:background|background-color)\s*:\s*([^;]+)/i),e=[],k=[];a&&(e.push("[font="+a[1]+"]"),k.push("[/font]"));c&&(e.push("[size="+c[1]+"]"),k.push("[/size]"));f&&(e.push("[color="+b(f[1])+"]"),k.push("[/color]"));h&&(e.push("[back="+b(h[1])+"]"),k.push("[/back]"));return e.join("")+d+k.join("")});for(c=0;3>c;c++)a=a.replace(/<(div|p)(?:\s+[^>]*?)?[\s"';]\s*(?:text-)?align\s*[=:]\s*(["']?)\s*(left|center|right)\s*\2[^>]*>(((?!<\1(\s+[^>]*?)?>)[\s\S])+?)<\/\1>/gi,"[align=$3]$4[/align]");for(c=0;3>c;c++)a=a.replace(/<(center)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,"[align=center]$2[/align]");for(c=0;3>c;c++)a=a.replace(/<(p|div)(?:\s+[^>]*?)?\s+style\s*=\s*"(?:[^;"]*;)*\s*text-align\s*:([^;"]*)[^"]*"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,function(a,b,c,d){return"[align="+c+"]"+d+"[/align]"});a=a.replace(/<a(?:\s+[^>]*?)?\s+href=(["'])\s*(.+?)\s*\1[^>]*>\s*([\s\S]*?)\s*<\/a>/gi,function(a,b,c,d){if(!c||!d)return"";a="url";c.match(/^mailto:/i)&&(a="email",c=c.replace(/mailto:(.+?)/i,"$1"));b="["+a;c!=d&&(b+="="+c);return b+"]"+d+"[/"+a+"]"});a=a.replace(/<img(\s+[^>]*?)\/?>/gi,function(a,b){var c=b.match(l),d=b.match(/\s+title\s*=\s*(["']?)\s*(.*?)\s*\1(\s|$)/i),g="[img";if(!c)return"";d=d?""+d[2]:"图像";d&&(g+="="+d);return g+="]"+c[2]+"[/img]"});a=a.replace(/<hr(\s+[^>]*?)?\/>/gi,"[hr/]");for(c=0;3>c;c++)a=a.replace(/<(p)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,"\r\n\r\n$2\r\n\r\n");for(c=0;3>c;c++)a=a.replace(/<(div)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,"\r\n$2\r\n");a=a.replace(/((\s|&nbsp;)*\r?\n){3,}/g,"\r\n\r\n");a=a.replace(/^((\s|&nbsp;)*\r?\n)+/g,"");a=a.replace(/((\s|&nbsp;)*\r?\n)+$/g,"");a=a.replace(/<[^<>]+?>/g,"");var p={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};a=a.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(a,b){return p[b]});return a=a.replace(/\[([a-z]+)(?:=[^\[\]]+)?\]\s*\[\/\1\]/gi,"")}