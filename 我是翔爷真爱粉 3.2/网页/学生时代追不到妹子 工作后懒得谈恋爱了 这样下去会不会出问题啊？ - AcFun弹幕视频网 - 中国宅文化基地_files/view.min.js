var __slice=[].slice,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};$(function(){return system.gate.guideFloatDisabled=1,$.require("ready",function(){var a;return system.func.saveHistory=function(){var a,b,c,d,e,f,g,h,i;for(e=1<=arguments.length?__slice.call(arguments,0):[],f=e[0]||"views",b=null!=(g=cache.history)[f]?g[f]:g[f]=[],d=system.post,c=h=0,i=b.length;i>h;c=++h)if(a=b[c],d.aid===a.aid){b.splice(c,1);break}return b.push({time:$.now(),date:d.date,aid:d.aid,title:d.title,cid:d.cid,tags:d.tags,preview:d.preview,uid:d.uid,name:d.name,avatar:d.avatar,cont:"comms"===f?e[1]:null}),b.length>(window.localStorage?100:20)&&b.splice(0,1),$.save("cache")},function(){var a,b,c,d,e,f,g,h,i,j;for(b=$$("#block-data-view"),c=function(a){return $.parseSafe(b.data(a)||"")},d=function(a){return 0|(b.data(a)||0)},system.post={},i=["name","avatar","title","tags","preview"],e=0,g=i.length;g>e;e++)a=i[e],system.post[a]=c(a);for(j=["uid","aid","cid","views","comms","favors","shares","time"],f=0,h=j.length;h>f;f++)a=j[f],system.post[a]=d(a);return system.post.desc=$$("#block-info-view").find("p.shadow").text(),system.post.tags=system.post.tags.split(","),system.post.date=$.timeStamp(b.data("date"))}(),"function"==typeof(a=system.func).readyPlayer&&a.readyPlayer(),function(){var a,b;return a=$$("#area-part-view"),system.post.parts=0|a.data().parts,system.post.part=0|a.data().part,a.data().parts>2?(b=$$("#btn-more-part"),b.data({active:0}).click(function(){return b.data().active?(b.data({active:0}).removeClass("active").find("p").text("展开").end().find("i").addClass("icon-plus-circle").removeClass("icon-minus-sign"),a.removeClass("active")):(b.data({active:1}).addClass("active").find("p").text("收起").end().find("i").addClass("icon-minus-sign").removeClass("icon-plus-circle"),a.addClass("active").scrollOnto(0).children("div.l").scrollTop(32*(a.find("a.active").eq(0).index()-1)))})):void 0}(),function(){var a,b;return b=$("#block-info-view p.desc:not(.shadow)"),a=b.html(),a=a.replace(/(?:(?:http:\/\/)?[\w\/\.\-]+?acfun\.[\w\/\.\-]+?)?\[?ac(\d+(?:_\d+)?)\]?/g,'<a href="http://www.acfun.tv/v/ac$1" target="_blank">[ac$1]</a>').replace(/(?:(?:http:\/\/)?[\w\/\.\-]+?acfun\.[\w\/\.\-]+?)?\[?aa(\d+)\]?/g,'<a href="http://www.acfun.tv/a/aa$1" target="_blank" title="该链接通向AcFun合辑">[aa$1]</a>').replace(/(?:(?:http:\/\/)?[\w\/\.\-]+?nicovideo\.[\w\/\.\-]+?)?\[?sm(\d+)\]?/g,'<a href="http://www.nicovideo.jp/watch/sm$1" title="该链接通向ニコニコ动画" target="_blank">[sm$1]</a>').replace(/\[wiki(\S+?)\]/g,'<a href="http://wiki.acfun.tv/index.php/$1" title="该链接通向AC百科" target="_blank">[$1]</a>'),b.html(a)}(),function(){var a,b,c,d;return a=$$("#block-info-view"),c=a.find("p.desc:not(.shadow)"),d=a.find("p.shadow"),d.height()>48&&(b=$("#btn-toggle-desc"),b.removeClass("hidden").data({active:0}).click(function(){return b.data().active?(c.css({height:48}),b.text("[+展开简介]").data({active:0})):(c.css({height:"auto"}),b.text("[-折叠简介]").data({active:1}))})),d.remove()}(),function(){var a,b;return a=$$("#txt-info-title"),a.data({post:null}),b=function(){return b.a(),b.b()},b.a=function(){var b;return system.param.shareUid&&(b=system.param.shareUid.match(/(\d+)?#?.*/),system.param.shareUid=b&&b[1]?b[1]:null),$.get("/content_view.aspx",{contentId:system.post.aid,channelId:system.post.cid,shareUid:system.param.shareUid!==user.uid?system.param.shareUid:null}).done(function(b){var c,d,e;return c=b.toString().split(","),e=a.children("span.pts"),e.eq(0).text($.parsePts(c[0])),d=c[1]>9999?Math.round(c[1]/1e3)/10+"万":$.parsePts(c[1]),e.eq(1).text($.parsePts(c[1])),$$("#btn-comm-view span").text(d),$$("#btn-top-shortcut").find("span.pts").text(d),d=c[3]>9999?Math.round(c[3]/1e3)/10+"万":$.parsePts(c[3]),$$("#btn-up-toolbar").find("span").text($.parsePts(c[3])),$$("#btn-up-view").find("span").text(d),d=c[5]>9999?Math.round(c[5]/1e3)/10+"万":$.parsePts(c[5]),e.eq(2).text($.parsePts(c[5])),$$("#btn-favor-toolbar").find("span").text($.parsePts(c[5])),$$("#btn-favor-view").find("span.pts").text(d),d=c[6]>9999?Math.round(c[6]/1e3)/10+"万":$.parsePts(c[6]),$$("#btn-banana-toolbar").find("span").text($.parsePts(c[6])),$$("#btn-banana-view").find("span").text(d)}).fail(function(){var b;return b="视频播放信息读取失败",a.text(b)})},b.b=function(){return $.get("/member/collect_up_exist.aspx",{contentId:system.post.aid}).done(function(a){var b,c,d,e,f,g,h;if(a.success&&(a.data.collect?(system.post.isFavored=1,$$("#btn-favor-view").data({active:1}).add("#btn-favor-toolbar").addClass("active").find("p").text("已收藏")):(system.post.isFavored=0,$$("#btn-favor-view").data({active:0}).add("#btn-favor-toolbar").removeClass("active").find("p").text("收藏")),a.data.up?(system.post.isUped=1,$$("#btn-up-view").data({active:1}).add("#btn-up-toolbar").addClass("active").find("p").text("已点赞")):system.post.isUped=0,a.data.banana?(system.post.isThrowed=1,$$("#btn-banana-view").data({active:1}).add("#btn-banana-toolbar").addClass("active").find("p").text("已投食")):system.post.isUped=0,a.data.follow?(system.post.isFollowing=1,$$("#btn-follow-author").addClass("active").data({active:1}).text("已关注")):(system.post.isFollowing=0,$$("#btn-follow-author").removeClass("active").data({active:0}).text("关注")),a.data.tagList)){for(d=$("#area-tag-view span.inner"),e=$("#temp-tag-view").html(),c="",h=a.data.tagList,f=0,g=h.length;g>f;f++)b=h[f],c+=$.parseTemp(e,{tid:b.tagId,name:$.parseSafe(b.tagName),count:$.parsePts(b.refCount)});return d.html(c)}})},(system.func.rvi=b)(),system.st-system.post.date<2592e6?(b.d=function(){var a;return b.t?b.a():b.t=5,setTimeout(b.d,6e4*b.t),b.t=(a=2*b.t)>30?30:a})():void 0}(),function(){var a,b;return b=$$("#btn-favor-view"),a=b.add("#btn-favor-toolbar"),a.click(function(){var c,d,e,f;return c=$(this),d=c.is(b)?"top":"bottom",c.hasClass("disabled")?void 0:(a.addClass("disabled"),setTimeout(function(){return a.removeClass("disabled")},1e3),user.online?(null!=(f=b.data().port)&&f.abort(),b.data().port=$.post("/member/collect.aspx",{cId:system.post.aid,operate:b.data().active?0:1}).done(function(e){var f;return e.success?b.data().active?(f="info::已取消当前视频收藏。",$.info(f),c.info({direction:d,text:f}),b.data({active:0}),a.removeClass("active").find("p").text("收藏"),system.func.rvi()):(f="success::已收藏当前视频。",$.info(f),c.info({direction:d,text:f}),b.data({active:1}),a.addClass("active").find("p").text("已收藏"),system.func.rvi()):(f="warning::"+e.result,$.info(f),c.info({direction:d,text:f}))}).fail(function(){var a;return a="warning::收藏操作失败。请于稍后重新操作。",$.info(a),c.info({direction:d,text:a})})):(e="warning::您尚未登录。请先行登录。",$.info(e),c.info({direction:d,text:e}).unfold("login")))})}(),function(){var a,b;return b=$$("#btn-up-view"),a=b.add("#btn-up-toolbar"),a.click(function(){var c,d,e,f;return c=$(this),d=c.is(b)?"top":"bottom",c.hasClass("disabled")?void 0:(a.addClass("disabled"),setTimeout(function(){return a.removeClass("disabled")},1e3),user.online?b.data().active?(e="warning::请勿重复点赞。",$.info(e),c.info({direction:d,text:e})):(null!=(f=b.data().port)&&f.abort(),b.data().port=$.post("/content_up.aspx",{contentId:system.post.aid}).done(function(e){var f;return e.success?(f="success::点赞成功。",$.info(f),c.info({direction:d,text:f}),b.data({active:1}),a.addClass("active").find("p").text("已点赞"),system.func.rvi()):(f="warning::"+e.result,$.info(f),c.info({direction:d,text:f}))}).fail(function(){var a;return a="warning::点赞操作失败。请于稍后重新操作。",$.info(a),c.info({direction:d,text:a})})):(e="warning::您尚未登录。请先行登录。",$.info(e),c.info({direction:d,text:e}).unfold("login")))})}(),function(){var a,b,c,d;return c=$$("#btn-banana-view"),b=$$("#btn-banana-toolbar"),d=b.find("div.panel"),a=d.find("div.bn"),b.on("mouseenter.throw",function(){var a;return a=$(this),a.hasClass("active")||a.hasClass("hover")?void 0:a.addClass("hover").info({text:"info::请选择投食香蕉数。",direction:"bottom"})}).on("mouseleave.throw",function(){var a;return a=$(this),a.hasClass("hover")?(a.removeClass("hover"),$$("#win-hint").css({display:"none"})):void 0}),a.on("mouseenter.throw",function(){var b,c,d,e,f,g;for(c=$(this),e=c.data().count-1,g=[],d=f=0;4>=f;d=++f)b=a.eq(d),g.push(e>=d?b.hasClass("active")?void 0:b.addClass("active"):b.hasClass("active")?b.removeClass("active"):void 0);return g}),c.on("click",function(){return b.scrollOnto().info({text:"info::请在这里选择投食数量。",direction:"bottom"})}),d.on("click.throw",".bn",function(){var a,d,e,f;return a=$(this),d=a.is(c)?"top":"bottom",b.hasClass("disabled")?void 0:(b.addClass("disabled"),setTimeout(function(){return b.removeClass("disabled")},1e3),user.online?c.data().active?(e="warning::请勿重复投食。",$.info(e),b.info({direction:d,text:e})):(null!=(f=c.data().port)&&f.abort(),c.data().port=$.post("/banana/throwBanana.aspx",{contentId:system.post.aid,count:a.data().count}).done(function(e){var f;return e.success?(f="success::成功投食了"+a.data().count+"根香蕉。",$.info(f),b.info({direction:d,text:f}),c.data({active:1}),b.addClass("active").find("p").text("已投食"),system.func.rvi()):(f="warning::"+e.result,$.info(f),b.info({direction:d,text:f}))}).fail(function(){var a;return a="warning::投食操作失败。请于稍后重新操作。",$.info(a),b.info({direction:d,text:a})})):(e="warning::您尚未登录。请先行登录。",$.info(e),b.info({direction:d,text:e}).unfold("login")))})}(),$$("#btn-comm-view").click(function(){return $$("#area-bottom-view").scrollOnto()}),$$("#btn-follow-author").click(function(){var a;return a=$(this),user.online?a.hasClass("disabled")?void 0:(a.addClass("disabled"),setTimeout(function(){return a.removeClass("disabled")},1e3),a.data().active?a.ensure({curtain:!0,text:"是否确认取消关注？",callback:function(){var b;return null!=(b=a.data().port)&&b.abort(),a.data().port=$.post("/api/friend.aspx?name=unfollow",{username:a.data().name,userId:a.data().uid,groupId:0}).done(function(b){var c;return b.success?(c="info::取消关注["+$.parseSafe(a.data().name)+"]成功。",$.info(c),a.info(c),system.func.rvi()):(c="warning::"+b.result,$.info(c),a.info(c))}).fail(function(){var b;return b="error::取消关注["+$.parseSafe(a.data().name)+"]失败。请于稍后重试。",$.info(b),a.info(b)})}}):a.unfold("follow",function(){return $("#win-follow").data({name:a.data().name,uid:a.data().uid,callback:system.func.rvi})})):void a.unfold("login")}),setTimeout(function(){return $.require("comm",function(){var a;return"function"==typeof(a=$$("#area-comment").data().func).ready?a.ready(function(){var a;return a=$$("#btn-showComm"),config.comment.autoShowCommentAllowed?a.click():a.css({display:"block"})}):void 0})},500),setTimeout(function(){var a;return a=system.post,$$("#bdshare").share({text:a.title+" Up主："+a.name+"  \n来自AcFun "+$.parseChannel(0|a.cid)+" 频道",url:"http://www.acfun.tv/"+("video"===system.type?"v/ac":"a/ac")+a.aid+(user.online?"?shareUid="+user.uid:""),preview:a.preview})},2e3),function(){var a,b;return a=$$("#area-tag-view"),b=$$("#btn-add-tag"),user.online&&(a.data().active?b.click(function(){var c,d,e;return c=5,user.level>=c?(d=a.find("span.tag"),d.length<10?b.edit({text:"请输入标签",width:160,callback:function(c){var d,e;return d=$.trim($.parseSafe(c.replace(/\s+/g,"_"))),d?(null!=(e=b.data().port)&&e.abort(),b.data().port=$.post("/addTag.aspx",{tagName:d,contentId:system.post.aid}).done(function(e){return e.success?(a.children("span.inner").text("载入中..."),$.info("success::添加标签["+d+"]成功。"),system.func.rvi.b()):($.info("warning:"+e.result),b.info(c))}).fail(function(){return $.info(c="error::同服务器通信失败。请于稍后重试。"),b.info(c)})):void 0}}):(e="warning::该视频标签数目已达上限。",$.info(e),b.info(e))):(e="warning::用户等级不足["+c+"]。无权添加标签。",$.info(e),b.info(e))}).removeClass("hidden"):b.addClass("disabled").text("该视频被设置为禁止添加标签").removeClass("hidden")),2===user.group&&(0|user.uid)===system.post.uid&&(user.group=3),0===user.group||3===user.group?a.addClass("manage").delegate("div.btn-delete","click",function(){var a,c;return a=$(this).closest("span.tag"),c=$.trim($.parseSafe(a.text().replace(/\(.*/,""))),a.ensure({curtain:!0,text:"是否确认删除标签["+c+"]？",callback:function(){var d;return null!=(d=b.data().port)&&d.abort(),b.data().port=$.post("/delTag.aspx",{contentId:system.post.aid,tagId:a.data().tid}).done(function(b){return b.success?(a.stop().transition({opacity:0},200,function(){return a.remove()}),$.info("info::删除标签["+c+"]成功。"),$$("#curtain").click()):$.info("warning::"+b.result)}).fail(function(){return $.info("error::同服务器通信失败。请于稍后重试。")})}})}):void 0}(),setTimeout(function(){var a;return"video"===system.type?(a=$$("#block-recom-view"),$.getScript("http://search.acfun.tv/like?"+$.param({id:"ac"+system.post.aid,pageSize:5,pageNo:1,type:1,cd:1})).done(function(){var b,c,d,e,f,g,h,i,j;if(d=system.tv,200===d.status&&(f=d.data.page.list,f.length)){for(c=[63,71,73,74,75,76,81,110,113],g=$("#temp-recom-view").text(),e="",i=0,j=f.length;j>i;i++)b=f[i],h=-1!==$.inArray(b.channelIds,c)?"/v/"+b.contentId:"/a/"+b.contentId,e+=$.parseTemp(g,{aid:b.contentId.replace("ac",""),home:"/u/"+(b.userId||4)+".aspx",url:h,preview:$.parseSafe(b.titleImg)||system.path.short+"/style/image/cover-day.png",title:$.parseSafe(b.title),views:b.views,comms:b.comments,name:$.parseSafe(b.username)||"熊猫"});return a.find(".mainer").html(e)}})):void 0},1e3),function(){return"article"===system.type&&(75===system.post.cid&&$("#area-player").find("img").length>1||75!==system.post.cid&&$("#area-player").find("img").length>8)?$.getScript(system.path.short+"/project/homura/script/manga.min.js"+$.salt(7)):void 0}(),setTimeout(system.func.saveHistory,1e4),function(){var a,b,c,d;a=system.post.cid,d=$.parseChannel.map;for(b in d)if(c=d[b],__indexOf.call(c,a)>=0){a=b;break}return $$("#guide-inner").children(".l").find('a[href="/v/list'+a+'/index.htm"]').addClass("current")}()})});